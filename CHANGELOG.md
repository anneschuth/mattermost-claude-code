# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

## [0.20.0] - 2026-01-01

### Added
- **Sticky message improvements** - Enhanced the channel sticky message with active sessions
  - Shows display name in bold (e.g., **Anne**) instead of username
  - Added session description below the title (generated by Claude)
  - Added install hint: `npm i -g claude-threads` in footer
  - Periodic refresh every 60 seconds to keep relative times current
  - Auto-cleanup of old sticky messages from failed runs at startup

### Fixed
- **Sticky message updates on session end** - Message now updates when sessions are:
  - Canceled via `!stop` or ‚ùå reaction
  - Paused/interrupted via `!escape` or ‚è∏Ô∏è reaction
  - Killed due to timeout
  - Failed to start or resume
- **Race condition in sticky updates** - Added mutex to prevent duplicate sticky posts when multiple updates happen concurrently

## [0.19.2] - 2026-01-01

### Added
- **Smart message breaking** - Breaks long responses into multiple messages at logical points
  - Reduces "Show More" toggles in Mattermost by breaking messages before they get too long
  - Breaks at logical points: after tool completions, before headings, after code blocks, at paragraph breaks
  - Soft threshold at 2000 chars / 15 lines triggers search for breakpoints
  - Hard threshold at 14K chars ensures messages stay within platform limits
  - Adds `*... (continued below)*` marker when breaking messages

### Fixed
- **Task list stays below subagent messages** - Task list now bumps to bottom when subagents start
  - Previously, subagent status messages would appear below the task list
  - Now the task list correctly repositions itself below subagent posts

## [0.19.1] - 2026-01-01

### Fixed
- **Task list collapse emoji now pre-added** - The üîΩ toggle emoji is now automatically added as a reaction when the task list is created, making it easy to click and collapse/expand the list (previously users had to manually add the emoji)
- **Improved thinking trace display** - Better formatting for extended thinking blocks
  - Use blockquote format (`> üí≠ *...*`) for cleaner visual separation
  - Increased preview length from 100 to 200 characters
  - Cut at word boundaries instead of mid-word for cleaner truncation

## [0.19.0] - 2026-01-01

### Added
- **Minimize/expand task list** - Toggle task list visibility with emoji reactions
  - React with üîΩ (`arrow_down_small`) or üîª (`small_red_triangle_down`) on the task list to toggle
  - Minimized view shows: `üìã **Tasks** (2/5 ¬∑ 40%) ¬∑ üîÑ Current task üîΩ`
  - Expanded view shows full task list with all items
  - State persists across session restarts
  - Similar to Ctrl-T in Claude Code CLI

### Changed
- **Unified CLI output styling** - Consistent 2-space indented output with emoji prefixes
  - Created centralized `src/utils/output.ts` module with shared color helpers
  - Keep-alive messages now use `‚òï Sleep prevention active (caffeinate)` format instead of `[keep-alive]` prefix
  - All files now import colors from the shared module instead of defining locally

## [0.18.0] - 2026-01-01

### Added
- **Keep-alive support** - Prevents system sleep while Claude sessions are active
  - Automatically starts when first session begins, stops when all sessions end
  - Cross-platform: macOS (`caffeinate`), Linux (`systemd-inhibit`), Windows (`SetThreadExecutionState`)
  - Enabled by default, disable with `--no-keep-alive` CLI flag or `keepAlive: false` in config
  - Shows `‚òï Keep-alive enabled` in startup output
- **Resume timed-out sessions via emoji reaction** - React with üîÑ to the timeout message or session header to resume a timed-out session
  - Timeout message now shows resume hint: "üí° React with üîÑ to resume, or send a new message to continue."
  - Resume also works by sending a new message in the thread (existing behavior)
  - Session header now displays truncated session ID for reference
  - Supports multiple resume emojis: üîÑ (arrows_counterclockwise), ‚ñ∂Ô∏è (arrow_forward), üîÅ (repeat)

### Fixed
- **Sticky task list**: Task list now correctly stops being sticky when all tasks are completed
  - Previously, the task list stayed at the bottom even after all tasks had `status: 'completed'`
  - Now properly detects when all tasks are done using `todos.every(t => t.status === 'completed')`

## [0.17.1] - 2025-12-31

### Fixed
- **Sticky task list optimization**: Completed task lists no longer move to the bottom
  - Once all tasks are done, the "~~Tasks~~ *(completed)*" message stays in place
  - Reduces unnecessary message deletions and recreations
  - Added `tasksCompleted` flag to session state for explicit tracking

### Changed
- **Task list visual separator**: Added horizontal rule (`---`) above task list for better visibility

## [0.17.0] - 2025-12-31

### Added
- **Sticky task list** - Task list now stays at the bottom of the thread
  - When Claude posts new content, the task list moves below it
  - When you send a follow-up message, the task list moves below your message
  - Task list updates in place without visual noise
  - Mirrors Claude Code CLI behavior where tasks are always at the bottom

### Fixed
- **Context prompt after restart**: Context prompt now appears after session restarts (worktree creation, `!cd`)
  - Previously, after worktree creation or directory change, the context prompt was skipped
  - Now users can include thread history when Claude restarts in a new directory
  - Added `needsContextPromptOnNextMessage` flag for deferred context prompt (after `!cd`)

## [0.16.8] - 2025-12-31

### Fixed
- **Context prompt**: Fixed context prompt appearing when starting a session with the first message in a thread
  - The triggering message was incorrectly included in the count, making it show "1 message before this point" when there were none

## [0.16.7] - 2025-12-31

### Fixed
- **Session resume**: Validate working directory exists before resuming sessions after restart
  - Prevents crashes when a worktree or directory has been deleted

## [0.16.6] - 2025-12-31

### Added
- **Worktree context**: Replay first user prompt after mid-session worktree creation (`!worktree create`)
- **Thread context prompt**: When starting a session mid-thread (replying to an existing thread), offers to include previous conversation context
  - Shows options for last 3, 5, or 10 messages (only options that make sense for available message count)
  - "All X messages" option when message count doesn't match standard options
  - 30-second timeout defaults to no context
  - Context is prepended to the initial prompt so Claude understands the conversation history

### Fixed
- **Plan mode approval**: Fixed API error "unexpected tool_use_id found in tool_result blocks" when approving plans
  - Claude Code CLI handles ExitPlanMode internally; changed to send user message instead of duplicate tool_result
- **Question reactions**: Fixed 2nd+ questions not responding to emoji reactions
  - Follow-up question posts weren't registered for reaction routing
- **Question answering**: Fixed duplicate tool_result when answering AskUserQuestion
  - Claude Code CLI handles AskUserQuestion internally; changed to send user message
- Session timeout warning showing negative minutes (e.g., "-24min")
- Warning now fires 5 minutes before timeout instead of after 5 minutes idle
- Stale sessions are now cleaned from persistence on startup

## [0.16.3] - 2025-12-31

### Fixed
- Build with `--target node` for Node.js compatibility (fixes "__require is not a function" error)
- Fixed package.json path resolution for bundled builds

## [0.16.2] - 2025-12-31

### Fixed
- CI: Use npm publish for reliable registry authentication (bun publish auth issues)

## [0.16.1] - 2025-12-31

### Fixed
- CI: Skip lifecycle scripts during `bun publish` to avoid husky error

## [0.16.0] - 2025-12-31

### Changed
- **Runtime**: Migrated from Node.js to Bun runtime for 5-8x faster startup
- **WebSocket**: Replaced `ws` package with native Bun WebSocket (browser-style API)
- **YAML**: Replaced `yaml` package with native `Bun.YAML`
- **Testing**: Replaced Vitest with native `bun test`
- **CI/CD**: Updated GitHub Actions to use Bun

### Removed
- Node.js dependency - **Bun 1.2.21+ is now required**
- Dependencies: `ws`, `yaml`, `tsx`, `vitest`, `@vitest/coverage-v8`

### Developer Experience
- ~2x faster test execution with `bun test`
- ~7-10x faster CI package installs
- Native TypeScript execution without transpilation

## [0.15.0] - 2025-12-30

### Changed
- **License**: Changed from MIT to Apache 2.0 (adds patent protection)

### Added
- **Community standards**: CODE_OF_CONDUCT.md, CONTRIBUTING.md, SECURITY.md
- **GitHub templates**: Issue templates (bug report, feature request), PR template
- **Dependabot**: Automated dependency updates for npm and GitHub Actions
- **README badges**: Added npm downloads, Node.js version, TypeScript, PRs welcome

### Security
- Updated dependencies via Dependabot

## [0.14.1] - 2025-12-30

### Fixed
- Don't show "update available" notice when running a newer version than npm (fixes stale cache edge case)

## [0.14.0] - 2025-12-30

### Added
- **Multi-platform architecture** - Foundation for supporting multiple chat platforms
  - New `PlatformClient` interface abstracts platform differences
  - Normalized types: `PlatformPost`, `PlatformUser`, `PlatformReaction`, `PlatformFile`
  - Mattermost implementation moved to `src/platform/mattermost/`
  - Slack support architecture ready (implementation pending)
- **YAML-based configuration** - New config format
  - Config file: `~/.config/claude-threads/config.yaml`
  - Support for multiple platform instances simultaneously
  - Interactive onboarding wizard creates YAML config

### Changed
- **Modular session management** - Broke 2,500-line monolith into focused modules
  - `session/manager.ts` (~635 lines) - Thin orchestrator
  - `session/lifecycle.ts` (~590 lines) - Session start/resume/exit
  - `session/events.ts` (~480 lines) - Claude CLI event handling
  - `session/commands.ts` (~510 lines) - User commands
  - `session/reactions.ts` (~210 lines) - Emoji reaction handling
  - `session/worktree.ts` (~520 lines) - Git worktree management
  - `session/streaming.ts` (~180 lines) - Message batching
  - Uses dependency injection for testability
- **Platform-agnostic utilities** - Moved emoji helpers to `src/utils/emoji.ts`
- **Cleaner logo exports** - Renamed to generic `getLogo()`, `LOGO`, `LOGO_INLINE`

### Removed
- **Legacy `.env` configuration** - Now uses YAML only (`config.yaml`)
- **`dotenv` dependency** - No longer needed
- Deprecated Mattermost-specific exports (`getMattermostLogo`, `MATTERMOST_LOGO`)
- Internal documentation files (moved to CLAUDE.md)

## [0.13.0] - 2025-12-29

### Added
- **`--setup` flag** - Re-run interactive setup wizard to reconfigure settings
  - Existing .env values are used as defaults (press Enter to keep)
  - Token field allows keeping existing token without re-entering
  - New settings added since initial setup are presented with built-in defaults
  - Config saved back to original location
- **Chrome and worktree settings in onboarding** - New setup prompts for:
  - Chrome integration (yes/no)
  - Git worktree mode (prompt/off/require)

### Changed
- **Improved README** - New tagline and improved intro section
- **Worktree documentation** - Added comprehensive Git Worktrees section to README
- **Updated CLI options** - Added `--chrome`, `--no-chrome`, `--worktree-mode`, `--setup` to README

### Fixed
- **Warning icon alignment** - Fixed spacing of ‚ö†Ô∏è icon in CLI startup output
- **WORKTREE_MODE documentation** - Fixed incorrect values in README (was `always`/`never`, now correctly `off`/`prompt`/`require`)

## [0.12.1] - 2025-12-29

### Fixed
- **Fix logo star positioning** - Right bottom star shifted left as intended
- **Update README** - Title changed to "Claude Threads" and logo added

## [0.12.0] - 2025-12-29

### Changed
- **Renamed project to `claude-threads`** - Complete rebrand from `mm-claude`
  - npm package: `mattermost-claude-code` ‚Üí `claude-threads`
  - CLI command: `mm-claude` ‚Üí `claude-threads`
  - Config directory: `~/.config/mm-claude/` ‚Üí `~/.config/claude-threads/`
  - MCP server: `mm-claude-permissions` ‚Üí `claude-threads-permissions`
  - GitHub repository: `mattermost-claude-code` ‚Üí `claude-threads`
- **New CT logo** - Stylized "CT" block characters replace the old "M" logo
  - Fresh visual identity matching the new name

## [0.11.2] - 2025-12-28

### Fixed
- **Fix worktree skip emoji** - Use emoji name `x` instead of Unicode `‚ùå`
  - Mattermost API expects emoji names for reactions, not Unicode characters
  - Was causing "Custom emoji have been disabled" error

## [0.11.1] - 2025-12-28

### Fixed
- **Fix worktree and `!cd` crash** - Claude CLI sessions are tied to working directory
  - Can't use `--resume` when switching directories (session ID is directory-specific)
  - Now generates fresh session ID when changing to worktree or new directory
  - Previously caused "[Exited: 1]" with "No conversation found with session ID"

## [0.11.0] - 2025-12-28

### Added
- **Git worktree support** - Isolate file changes between concurrent sessions
  - Smart detection prompts for a branch when uncommitted changes or concurrent sessions exist
  - Reply with a branch name to create a worktree, or react with ‚ùå to skip
  - Inline syntax: `@bot on branch feature/x help me implement...`
  - `!worktree <branch>` - Create and switch to a git worktree
  - `!worktree list` - List all worktrees for the repo
  - `!worktree switch <branch>` - Switch to an existing worktree
  - `!worktree remove <branch>` - Remove a worktree
  - `!worktree off` - Disable worktree prompts for this session
  - Configure via `WORKTREE_MODE=off|prompt|require` (default: `prompt`)
  - Worktrees persist after session ends (manual cleanup)
  - Session header shows worktree info when active

## [0.10.11] - 2025-12-28

### Fixed
- **Permission prompts now update after approval/denial** - Shows result inline
  - "‚ö†Ô∏è Permission requested" ‚Üí "‚úÖ Allowed by @user" or "‚ùå Denied by @user"
  - Consistent with plan approval and message approval behavior

## [0.10.10] - 2025-12-28

### Fixed
- **Fixed `!permissions interactive` command** - Now actually enables interactive permissions
  - Previously, the command set a flag but didn't restart Claude CLI, so permissions didn't change
  - Now properly restarts Claude CLI with the MCP permission server enabled
  - Permission prompts (üëç Allow | ‚úÖ Allow all | üëé Deny) now appear as expected
  - Conversation context is preserved via `--resume` flag

## [0.10.9] - 2025-12-28

### Changed
- **Code quality refactoring** - Extracted shared utilities and added comprehensive test suite
  - New `src/mattermost/api.ts` - Shared REST API layer for bot and MCP server
  - New `src/utils/logger.ts` - Standardized logging with `mcpLogger` and `wsLogger`
  - New `createInteractivePost()` helper for posts with reaction options
  - Extracted emoji constants and helpers to `src/mattermost/emoji.ts`
  - Extracted tool formatting to `src/utils/tool-formatter.ts`

### Added
- **125 unit tests** - Comprehensive test coverage for refactored modules
  - API layer tests (21 tests)
  - Emoji helper tests (31 tests)
  - Tool formatter tests (58 tests)
  - Logger tests (15 tests)

## [0.10.8] - 2025-12-28

### Changed
- **Improved Claude in Chrome tool display** - Chrome automation tools now display like the native CLI
  - `üåê **Chrome**[computer] \`screenshot\`` instead of `üîå **computer** *(claude-in-chrome)*`
  - Shows action details: `left_click at (608, 51)`, `type "search query"`, `scroll down`
  - Consistent formatting across all Chrome tools (navigate, tabs, read_page, etc.)

## [0.10.7] - 2025-12-28

### Fixed
- **Fixed `!context` and `!cost` commands** - These commands now properly display output
  - Claude Code slash commands (`/context`, `/cost`) output via `user` events with `<local-command-stdout>` tags
  - Added handling for these events so the output is displayed in Mattermost

## [0.10.6] - 2025-12-28

### Fixed
- **Fixed diff display** - Removed misleading line numbers and noise from diffs
  - No more fake `@@ -1,1 +1,1 @@` headers (we don't have real line numbers)
  - No more `\ No newline at end of file` noise
  - Uses `diffLines()` for proper line-by-line change detection
  - Shows context lines (unchanged parts) naturally

## [0.10.5] - 2025-12-28

### Changed
- **Improved diff display** - Edit operations now show unified diffs with context
  - Uses standard unified diff format (like `git diff`)
  - Shows 3 lines of context around changes
  - More compact: changed lines shown once, not duplicated
  - Line numbers in `@@ -X,Y +X,Y @@` format

## [0.10.4] - 2025-12-28

### Added
- **`--chrome` flag** - Enable Claude in Chrome integration
  - Pass `--chrome` CLI flag or set `CLAUDE_CHROME=true` environment variable
  - Allows Claude to control your Chrome browser for web automation
  - Use `--no-chrome` to explicitly disable
- **Claude Code commands** - New session commands for context and cost management
  - `!context` - Show context usage (tokens used/remaining)
  - `!cost` - Show token usage and cost for this session
  - `!compact` - Compress context to free up space (useful when running low on context)
  - Commands are translated to Claude Code's `/context`, `/cost`, `/compact` slash commands

## [0.10.3] - 2025-12-28

### Changed
- **Improved task list UX**
  - Progress indicator: `üìã **Tasks** (2/5 ¬∑ 40%)`
  - Elapsed time for in-progress tasks: `üîÑ **Running tests...** (45s)`
  - Better pending icon: `‚óã` instead of `‚¨ú` (no longer overlaps)
- **Tool output now shows elapsed time**
  - Long-running tools (‚â•3s) show completion time: `‚Ü≥ ‚úì (12s)`
  - Errors also show timing: `‚Ü≥ ‚ùå Error (5s)`

### Fixed
- **Paused sessions now resume on new message** - messages to paused sessions were being ignored
  - After ‚è∏Ô∏è interrupt, sending a new message in the thread now resumes the session
  - Previously messages without @mention were ignored because the session was removed from memory
  - Added `hasPausedSession()`, `resumePausedSession()`, and `getPersistedSession()` methods

## [0.10.2] - 2025-12-28

### Changed
- Version number now displays directly after "claude-threads" in the logo instead of on a separate line

### Fixed
- **Interrupt (‚è∏Ô∏è) no longer kills session** - sessions now pause and can be resumed
  - Previously SIGINT caused Claude CLI to exit and the session was lost
  - Now session is preserved and user can send a new message to continue
  - Works with both ‚è∏Ô∏è reaction and `!escape`/`!interrupt` commands
- **Filter `<thinking>` tags from output** - Claude's internal thinking is no longer shown to users
  - Previously `<thinking>...</thinking>` tags would appear literally in Mattermost messages

## [0.10.1] - 2025-12-28

### Fixed
- **`!kill` now works from any message** - previously only worked within active session threads
  - Can now send `!kill` or `@bot !kill` as the very first message to emergency shutdown
  - Useful when bot is misbehaving and you need to stop it immediately

## [0.10.0] - 2025-12-28

### Added
- **ASCII art logo** - Stylized "M" in Claude Code's block character style
  - Shows on CLI startup with Mattermost blue and Claude orange colors
  - Shows at the top of every Mattermost session thread
  - Festive stars (‚ú¥) surround the logo
- **`!kill` command** - Emergency shutdown that kills ALL sessions and exits the bot
  - Only available to globally authorized users (ALLOWED_USERS)
  - Unpersists all sessions (they won't resume on restart)
  - Posts notification to all active session threads before exiting
- **`!escape` / `!interrupt` commands** - Soft interrupt like pressing Escape in CLI
  - Sends SIGINT to Claude CLI, stopping current task
  - Session stays alive and user can continue the conversation
  - Also available via ‚è∏Ô∏è reaction on any message in the session

### Fixed
- **Fix plan mode getting stuck after approval** - tool calls now get proper responses
  - `ExitPlanMode` and `AskUserQuestion` now receive `tool_result` instead of user messages
  - Claude was waiting for tool results that never came, causing sessions to hang
  - Added `toolUseId` tracking to `PendingApproval` interface

## [0.9.3] - 2025-12-28

### Fixed
- **Major fix for session persistence** - completely rewrote session lifecycle management
  - Sessions now correctly survive bot restarts (was broken in 0.9.0-0.9.2)
  - `killAllSessions()` now explicitly preserves persistence instead of relying on exit event timing
  - `killSession()` now takes an `unpersist` parameter to control persistence behavior
  - `handleExit()` now only unpersists on graceful exits (code 0), not on errors
  - Resumed sessions that fail are preserved for retry instead of being removed
  - Added comprehensive debug logging to trace session lifecycle
  - Race condition between shutdown and exit events eliminated

## [0.9.2] - 2025-12-28

### Fixed
- **Fix session persistence** - sessions were being incorrectly cleaned as "stale" on startup
  - The `cleanStale()` call was removing sessions older than 30 minutes before attempting to resume
  - Now sessions survive bot restarts regardless of how long the bot was down
  - Added debug logging (`DEBUG=1`) to trace persistence operations
- **Fix crash on Mattermost API errors** - bot no longer crashes when posts fail
  - Added try-catch around message handler to prevent unhandled exceptions
  - Added try-catch around reaction handler
  - Graceful error handling when session start post fails (e.g., deleted thread)

## [0.9.1] - 2025-12-28

### Changed
- Resume message now shows version: "Session resumed after bot restart (v0.9.1)"
- Session header is updated with new version after resume

### Fixed
- Fix duplicate "Bot shutting down" messages when stopping bot
- Fix "[Exited: null]" message appearing during graceful shutdown

## [0.9.0] - 2025-12-28

### Added
- **Session persistence** - Sessions now survive bot restarts!
  - Active sessions are saved to `~/.config/claude-threads/sessions.json`
  - On bot restart, sessions are automatically resumed using Claude's `--resume` flag
  - Users see "Bot shutting down - session will resume" when bot stops
  - Users see "Session resumed after bot restart" when session resumes
  - Session state (participants, working dir, permissions) is preserved
  - Stale sessions (older than SESSION_TIMEOUT_MS) are cleaned up on startup
  - Thread existence is verified before resuming (deleted threads are skipped)

### Fixed
- Truncate messages longer than 16K chars to avoid Mattermost API errors

## [0.8.1] - 2025-12-28

### Added
- **`!release-notes` command** - Show release notes for the current version
- **"What's new" in session header** - Shows a brief summary of new features when starting a session

## [0.8.0] - 2025-12-28

### Added
- **Image attachment support** - Attach images to your messages and Claude Code will analyze them
- Supports JPEG, PNG, GIF, and WebP formats
- Images are downloaded from Mattermost and sent to Claude as base64-encoded content blocks
- Works for both new sessions and follow-up messages
- Debug logging shows attached image details (name, type, size)

## [0.7.3] - 2025-12-28

### Fixed
- Actually fix `!cd` showing "[Exited: null]" - reset flag in async exit handler, not synchronously

## [0.7.2] - 2025-12-28

### Fixed
- Fix `!cd` command showing "[Exited: null]" message - now properly suppresses exit message during intentional restart

## [0.7.1] - 2025-12-28

### Fixed
- Fix infinite loop when plan is approved - no longer sends "Continue" message on subsequent ExitPlanMode calls

## [0.7.0] - 2025-12-28

### Added
- **`!cd <path>` command** - Change working directory mid-session
- Restarts Claude Code in the new directory with fresh context
- Session header updates to show current working directory
- Validates directory exists before switching

## [0.6.1] - 2025-12-28

### Changed
- Cleaner console output: removed verbose `[Session]` prefixes from logs
- Debug-only logging for internal session state changes (plan approval, question handling)
- Consistent emoji formatting for all log messages

## [0.6.0] - 2025-12-28

### Added
- **Auto-update notifications** - shows banner in session header when new version is available
- Checks npm registry on startup for latest version
- Update notice includes install command: `npm install -g claude-threads`

## [0.5.9] - 2025-12-28

### Fixed
- Security fix: sanitize bot username in regex to prevent injection

## [0.5.8] - 2025-12-28

### Changed
- Commands now use `!` prefix instead of `/` to avoid Mattermost slash command conflicts
- `!help`, `!invite`, `!kick`, `!permissions`, `!stop` replace `/` versions
- Commands without prefix (`help`, `stop`, `cancel`) still work

## [0.5.7] - 2025-12-28

### Fixed
- Bot now recognizes mentions with hyphens in username (e.g., `@annes-minion`)
- Side conversation detection regex updated to handle full Mattermost usernames

## [0.5.6] - 2025-12-28

### Added
- Timeout warning 5 minutes before session expires
- Warning message tells user to send a message to keep session alive
- Warning resets if activity resumes

## [0.5.5] - 2025-12-28

### Added
- `/help` command to show available session commands

### Changed
- Replace ASCII diagram with Mermaid flowchart in README

## [0.5.4] - 2025-12-28 (not released)

### Added
- `/help` command to show available session commands

## [0.5.3] - 2025-12-28

### Added
- `/permissions interactive` command to enable interactive permissions for a session
- Can only downgrade permissions (auto ‚Üí interactive), not upgrade
- Session header updates to show current permission mode

## [0.5.2] - 2025-12-28

### Changed
- Complete README rewrite with full documentation of all features

## [0.5.1] - 2025-12-28

### Added
- `--no-skip-permissions` flag to enable interactive permissions even when `SKIP_PERMISSIONS=true` is set in env

## [0.5.0] - 2025-12-28

### Added
- **Session collaboration** - invite users to specific sessions without global access
- **`/invite @username`** - Temporarily allow a user to participate in the current session
- **`/kick @username`** - Remove an invited user from the current session
- **Message approval flow** - When unauthorized users send messages in a session thread, the session owner/allowed users can approve via reactions:
  - üëç Allow this single message
  - ‚úÖ Invite them to the session
  - üëé Deny the message
- Per-session allowlist tracked via `sessionAllowedUsers` in each session
- **Side conversation support** - Messages starting with `@someone-else` are ignored, allowing users to chat without triggering the bot
- **Dynamic session header** - The session start message updates to show current participants when users are invited or kicked

### Changed
- Session owner is automatically added to session allowlist
- Authorization checks now use `isUserAllowedInSession()` for follow-ups
- Globally allowed users can still access all sessions

## [0.4.0] - 2025-12-28

### Added
- **CLI arguments** to override all config options (`--url`, `--token`, `--channel`, etc.)
- **Interactive onboarding** when no `.env` file exists - guided setup with help text
- Full `--help` output with all available options
- `--debug` flag to enable verbose logging

### Changed
- Switched from manual arg parsing to `commander` for better CLI experience
- Config now supports: CLI args > environment variables > defaults

## [0.3.4] - 2025-12-27

### Added
- Cancel sessions with `/stop`, `/cancel`, `stop`, or `cancel` commands in thread
- Cancel sessions by reacting with ‚ùå or üõë to any post in the thread

## [0.3.3] - 2025-12-27

### Added
- WebSocket heartbeat to detect dead connections after laptop sleep/idle
- Automatic reconnection when connection goes silent for 60+ seconds
- Ping every 30 seconds to keep connection alive

### Fixed
- Connections no longer go "zombie" after laptop sleep - claude-threads now detects and reconnects

## [0.3.2] - 2025-12-27

### Fixed
- Session card now correctly shows "claude-threads" instead of "Claude Code"

## [0.3.1] - 2025-12-27

### Changed
- Cleaner console output with colors (verbose logs only shown with `DEBUG=1`)
- Pimped session start card in Mattermost with version, directory, user, session count, permissions mode, and prompt preview
- Typing indicator starts immediately when session begins
- Shortened thread IDs in logs for readability

## [0.3.0] - 2025-12-27

### Added
- **Multiple concurrent sessions** - each Mattermost thread gets its own Claude CLI process
- Sessions tracked via `sessions: Map<threadId, Session>` and `postIndex: Map<postId, threadId>`
- Configurable session limits via `MAX_SESSIONS` env var (default: 5)
- Automatic idle session cleanup via `SESSION_TIMEOUT_MS` env var (default: 30 min)
- `killAllSessions()` for graceful shutdown of all sessions
- Session count logging for monitoring

### Changed
- `SessionManager` now manages multiple sessions instead of single session
- `sendFollowUp(threadId, message)` takes threadId parameter
- `isInSessionThread(threadId)` replaces `isInCurrentSessionThread()`
- `killSession(threadId)` takes threadId parameter

### Fixed
- Reaction routing now uses post index lookup for correct session targeting

## [0.2.3] - 2025-12-27

### Added
- GitHub Actions workflow for automated npm publishing on release

## [0.2.2] - 2025-12-27

### Added
- Comprehensive `CLAUDE.md` with project documentation for AI assistants

## [0.2.1] - 2025-12-27

### Added
- `--version` / `-v` flag to display version
- Version number shown in `--help` output

### Changed
- Lazy config loading (no .env file needed for --version/--help)

## [0.2.0] - 2025-12-27

### Added
- Interactive permission approval via Mattermost reactions
- Permission prompts forwarded to Mattermost thread
- React with üëç to allow, ‚úÖ to allow all, or üëé to deny
- Only authorized users (ALLOWED_USERS) can approve permissions
- MCP-based permission server using Claude Code's `--permission-prompt-tool`
- `SKIP_PERMISSIONS` env var to control permission behavior

### Changed
- Permissions are now interactive by default (previously skipped)
- Use `SKIP_PERMISSIONS=true` or `--dangerously-skip-permissions` to skip

## [0.1.0] - 2024-12-27

### Added
- Initial release
- Connect Claude Code CLI to Mattermost channels
- Real-time streaming of Claude responses
- Interactive plan approval with emoji reactions
- Sequential question flow with emoji answers
- Task list display with live updates
- Code diffs for Edit operations
- Content preview for Write operations
- Subagent status tracking
- Typing indicator while Claude is processing
- User allowlist for access control
- Bot mention detection for triggering sessions
